=pod

=head1 NAME

B<yafscii> - YAF Flow Printer

=head1 SYNOPSIS

    yafscii [--in INPUT_SPECIFIER] [--out OUTPUT_SPECIFIER]
            [--nextdir PROCESSED_INPUT_DIRECTORY]
            [--faildir FAILED_INPUT_DIRECTORY]
            [--poll POLLING_DELAY] [--lock]
            [--log LOG_SPECIFIER] [--loglevel LOG_LEVEL]
            [--verbose] [--version] [--daemon] [--foreground]
            [--tabular] [--mac] [--print-header]

=head1 DESCRIPTION

B<yafscii> takes IPFIX flow data files generated by yaf(1) and prints them 
in an ASCII format loosely analogous to that produced by tcpdump(1), with one 
flow per line. The text output format is detailed in the B<OUTPUT> section, 
below. B<yafscii> is generally intended to be used to print single files for 
verification or debugging purposes, or to operate in a pipe with yaf(1),
but it can be used as a daemon as well.  B<yafscii> ignores yaf(1) stats records.

=head1 OPTIONS

=head2 Input Options

The input specifier determines where yafscii will read its 
input from. If the input specifier is not given, yaf defaults to reading 
from standard input. 

=over 4

=item B<--in> I<INPUT_SPECIFIER>

I<INPUT_SPECIFIER> is an input specifier. This is a filename, a directory 
name, a file glob pattern (in which case it should be 
escaped or quoted to prevent the shell from expanding the glob pattern), or 
the string B<-> to read from standard input. 

=back

=head2 Output Options

The output specifier determines where yaf will send its output. If reading 
standard input, output defaults to standard output. If reading from files on 
disk, output defaults to one file per input file, named as the input file in 
the same directory as the input file with a B<.txt> extension.

=over 8

=item B<--out> I<OUTPUT_SPECIFIER>

I<OUTPUT_SPECIFIER> is an output specifier. This should be a filename or a 
directory name, or the string B<-> to write to standard output.

=item B<--tabular>

Use tabular output mode, which is designed for easy parsability over
human readability. See the Tabular Output section below for details.

=item B<--mac>

Used with B<--tabular> mode to print source and destination MAC Addresses.

=item B<--print-header>

Used with B<--tabular> mode to print column headers.

=back

=head2 Daemon Options

These options are used to run yafscii in daemon mode for batch processing of
pcap dumpfiles.

=over 4

=item B<--daemon>

Run yafscii in daemon mode. Instead of processing its input then exiting, 
yafscii will continually look for new input matching its input specifier. 
This will cause yaf to fork into the background and exit.
=item B<--foreground>

Instead of forking in B<--daemon> mode, stay in the foreground. 
Useful for debugging.

=item B<--lock>

Use lockfiles for concurrent file access protection. Highly recommended in 
B<--daemon> mode, especially if two daemons are interacting through a 
given directory.

=item B<--poll> I<POLLING_DELAY>

I<POLLING_DELAY> is the polling delay in seconds; how long yaf will 
wait for new input when none is available. The default is 60 seconds.

=item B<--nextdir> I<PROCESSED_INPUT_DIRECTORY>

When reading from files, if this option is present, input files will be 
moved to I<PROCESSED_INPUT_DIRECTORY> after they are successfully processed. 
The special string B<delete> will cause successfully processed input to be 
removed instead. This option is required in daemon mode.

=item B<--faildir> I<FAILED_INPUT_DIRECTORY>

When reading from files, if this option is present, input files will be 
moved to I<FAILED_INPUT_DIRECTORY> if processing failed. 
The special string B<delete> will cause failed input to be 
removed instead. This option is required in daemon mode.

=back

=head2 Logging Options

These options are used to specify how log messages are routed. yaf can 
log to standard error, regular files, or the UNIX syslog facility.

=over 4

=item B<--log> I<LOG_SPECIFIER>

Specifies destination for log messages. I<LOG_SPECIFIER> can be a syslog(3)
facility name, the special value B<stderr> for standard error, or the 
I<absolute> path to a file for file logging. Standard error logging is only 
available in B<--daemon> mode if B<--foreground> is present. The default log 
specifier is B<stderr> if available, B<user> otherwise.

=item B<--loglevel> I<LOG_LEVEL>

Specify minimum level for logged messages. In increasing levels of verbosity, 
the supported log levels are B<quiet>, B<error>, B<critical>, B<warning>, 
B<message>, B<info>, and B<debug>. The default logging level is B<warning>.

=item B<--verbose>

Equivalent to B<--loglevel debug>.

=item B<--version>

If present, print version and copyright information to standard error and exit.

=back

=head1 OUTPUT 

=head2 Human-Readable Output

yafscii's default output format, like that of tcpdump, is designed to be easily 
human-readable, at the possible expense of ease of automated parsing. 
Each flow is represented by a single output line representing the flow 
itself, followed by zero or more indented lines containing flow payload in 
hexdump format. This section details each flow format, where each field 
specifier is as follows:

=over 4

=item I<start-time>, I<end-time>

Flow start or end time in ISO 8601 format, with milliseconds 
(I<YYYY>-I<MM>-I<DD> I<hh>:I<mm>:I<ss>.I<ssss>). Start time is printed with
a date; end time is not. End time is only present if the flow has a
non-zero duration.

=item I<duration>

Flow duration in fractional seconds. Only present if the flow has a 
non-zero duration.

=item I<proto>

IP protocol identifier in decimal format.

=item I<sip>, I<dip>

Source or destination IPv4 address in dotted-quad format or IPv6 address in 
RFC 2373 format.

=item I<sp>, I<dp>

Source or destination transport port in decimal format.

=item I<type>, I<code>

ICMP type or code in decimal format.

=item I<isn>, I<risn>

Forward or reverse initial TCP sequence number in hexadecimal format.

=item I<iflags>, I<riflags>, I<uflags>, I<ruflags>

Foward or reverse first-packet TCP flags; forward or reverse I<n>th-packet 
TCP flags union; where each flags bit is represented by the first character 
in the flag's name: B<F>IN, B<S>YN, B<R>ST, B<P>SH, B<A>CK, B<U>RG, B<E>CE, 
B<C>WR. The character B<0> means no flags are set (and will appear in the 
I<n>th-packet field for single-packet TCP flows).

=item I<tag>, I<rtag>

Forward or reverse first-packet 802.1q VLAN tag in hexadecimal format.

=item I<srcMacAddress>, I<destMacAddress>

Source or Destination MAC Address.

=item I<pkt>, I<rpkt>

Forward or reverse packet count in decimal format.

=item I<oct>, I<roct>

Forward or reverse octet count in decimal format.

=item I<rtt>

Round-trip time estimate in milliseconds in decimal format.

=item I<end-reason>

If not present, the flow ended normally (i.e., by TCP RST or FIN). Otherwise, the I<end-reason> is one of the following strings:

=over 5

=item B<idle> 

Flow was expired by idle timeout. No packets were received for 
I<IDLE_TIMEOUT> seconds (see yaf(1)) and the flow was presumed closed.

=item B<active>

Flow was expired by active timeout. The flow's duration was longer than 
I<ACTIVE_TIMEOUT> seconds (see yaf(1)) and the flow was flushed from the 
flow table.

=item B<eof>

Flow was still active in the flow table at the end of the dumpfile or at 
yaf(1) shutdown time; it was flushed as the flow table was cleared.

=item B<rsrc>

Flow was prematurely flushed as B<idle> because more than I<FLOW_TABLE_MAX> 
flows (see yaf(1)) were active in the flow table.

=item B<force>

B<yaf> forced a write of the flow, but the flow remained open.  This is only seen if yaf operated with the B<--udp-uniflow> flag, which exports each UDP packet as a flow record, but allows the flow to remain open until it closes naturally by idle and active timeouts (see yaf(1)).

=back 

=item B<applabel>

The application label, if yaf(1) was built with application labeling enabled and
the application labeler was able to identify the payload in the flow.

=item B<entropy>

The Shannon-Fano Entropy for the forward then the reverse flow payload if the payload
existed and yaf(1) was built with entropy enabled.

=back

Each flow line format is as follows:

=over 4

=item Unidirectional IP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<ip> I<proto> I<sip> B<=E<gt>> I<dip> [B<vlan> I<tag>] B<(>I<pkt>B<E<sol>>I<oct> B<-E<gt>)> [I<end-reason>]

=item Unidirectional UDP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<udp> I<sip>B<:>I<sp> B<=E<gt>> I<dip>B<:>I<dp> [B<vlan> I<tag>] B<(>I<pkt>B<E<sol>>I<oct> B<-E<gt>)> [I<end-reason>]

=item Unidirectional TCP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<tcp> I<sip>B<:>I<sp> B<=E<gt>> I<dip>B<:>I<dp> I<isn> I<iflags>B<E<sol>>I<uflags> [B<vlan> I<tag>] B<(>I<pkt>B<E<sol>>I<oct> B<-E<gt>)> [I<end-reason>]

=item Unidirectional ICMP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<icmp> B<[>I<type>B<:>I<code>B<]> I<sip> B<=E<gt>> I<dip> [B<vlan> I<tag>] B<(>I<pkt>B<E<sol>>I<oct> B<-E<gt>)> [I<end-reason>]

=item Bidirectional IP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<ip> I<proto> I<sip> B<=E<gt>> I<dip> [B<vlan> I<tag>B<:>I<rtag>] B<(>I<pkt>B<E<sol>>I<oct> B<E<lt>-E<gt>> I<rpkt>B<E<sol>>I<roct>B<) rtt> I<rtt> B<ms> [I<end-reason>]

=item Bidirectional UDP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<udp> I<sip>B<:>I<sp> B<=E<gt>> I<dip>B<:>I<dp> [B<vlan> I<tag>B<:>I<rtag>] B<(>I<pkt>B<E<sol>>I<oct> B<E<lt>-E<gt>> I<rpkt>B<E<sol>>I<roct>B<) rtt> I<rtt> B<ms> [I<end-reason>]

=item Bidirectional TCP flow

I<start-time> [B<-> I<end-time> B<(>I<duration> B<sec)>] B<tcp> I<sip>B<:>I<sp> B<=E<gt>> I<dip>B<:>I<dp> I<isn>B<:>I<risn> I<iflags>B<E<sol>>I<uflags>B<:>I<riflags>B<E<sol>>I<ruflags> [B<vlan> I<tag>B<:>I<rtag>] B<(>I<pkt>B<E<sol>>I<oct> B<E<lt>-E<gt>> I<rpkt>B<E<sol>>I<roct>B<) rtt> I<rtt> B<ms> [I<end-reason>]

=back

If present, the payload follows each flow line. Forward direction payload lines 
are prefixed with the string B<-E<gt>>, and reverse direction payload lines are 
prefixed with the string B<E<lt>->. Payload is only taken from the first packet 
for non-TCP flows (see yaf(1)).

=head2 Tabular Output

In B<--tabular> mode, yafscii prints its output as a table, without a header, 
with one flow per line and no payload information. Each column is separated by 
a pipe character. Columns have constant width and are filled with leading 
zeroes or spaces as appropriate. Every column appears in each row whether it is 
present in the flow data or not; non-present columns are represented with a
B<0>. All columns are formatted as they are in the human-readable output, 
except I<end-time> which appears with a data and I<rtt> which is expressed in 
fractional seconds instead of decimal milliseconds. For ICMP flows, ICMP type
and code appear in the I<dp> field, which has the value 256(I<type>) + I<code>.
I<srcMacAddress> and I<destMacAddress> will only print if B<--mac> is used.
The order of columns is as follows:

I<start-time>B<|> I<end-time>B<|> I<duration>B<|> I<rtt>B<|>
I<proto>B<|> I<sip>B<|> I<sp>B<|> I<dip>B<|> I<dp>B<|>
I<srcMacAddress>B<|> I<destMacAddress>B<|> 
I<iflags>B<|> I<uflags>B<|> I<riflags>B<|> I<ruflags>B<|>
I<isn>B<|> I<risn>B<|> I<tag>B<|> I<rtag>B<|> I<pkt>B<|> 
I<oct>B<|> I<rpkt>B<|> I<roct>B<|> I<applabel>B<|>
I<entropy>B<|> I<rentropy>B<|> I<end-reason>

=head1 SIGNALS

yafscii responds to B<SIGINT> or B<SIGTERM> by terminating input processing
and exiting. 

=head1 BUGS

Known issues are listed in the B<README> file in the YAF tools source 
distribution. Note that YAF should be considered alpha-quality software; not 
every conceivable input and option is exhaustively tested at each 
release, and specific features may be completely untested. Please be mindful 
of this before deploying YAF in production environments. YAF's output format 
may also change, as the development of YAF is intended to track progress in 
the IPFIX working group; the file output of YAF should not presently be used 
for archival storage of flow data. Bug reports and feature requests may be 
sent directly to the Network Situational Awareness team at 
E<lt>netsa-help@cert.orgE<gt>.

=head1 AUTHORS

Brian Trammell, Chris Inacio, Michael Duggan, 
and the CERT Network Situational Awareness Group Engineering Team, 
E<lt>http://www.cert.org/netsaE<gt>.

=head1 SEE ALSO

yaf(1)

=cut
